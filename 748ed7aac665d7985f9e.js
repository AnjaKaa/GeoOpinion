!function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,o){e.exports={default:o(2),__esModule:!0}},function(e,t,o){"use strict";function n(){function e(e){if(inputPlace.value&&inputName.value&&inputOpinion.value){""==i&&(i=u.balloon._balloon._data.properties.get("balloonContentHeader")),console.log("Адрес",i);var o=!0;l.some(function(e){return e.address==i})?(console.log("есть уже метка по адресу "+i),o=!1):console.log("добавляем новую метку");var p={coords:s,address:i,place:inputPlace.value,name:inputName.value,opinion:inputOpinion.value,date:d()};if(l.push(p),localStorage.setItem("myPlacemarkList",(0,r.default)(l)),o){var b=t(p);u.geoObjects.add(b),v.add(b),c.push(b)}else for(var f=0;f<c.length;f++)c[f].properties.get("balloonContentHeader")==i&&c[f].properties.set("balloonContentBody",n(i));return listOpinionForAddress.innerHTML=a(i),console.log("отзыв добавлен по адресу "+i),b}alert("Не все поля заполнены! Отзыв не будет добавлен")}function t(e){return new ymaps.Placemark(e.coords,{iconCaption:"",balloonContentHeader:e.address,balloonContentBody:n(e.address),balloonPlace:e.place,balloonDate:e.date,balloonOpinion:e.opinion,balloonCoords:e.coords},{balloonLayout:p,balloonContentLayout:b})}function o(e){return ymaps.geocode(e).then(function(e){return e.geoObjects.get(0).properties.get("metaDataProperty.GeocoderMetaData.AddressDetails").Country.AddressLine})}function n(e){var t="";return t+='<div id="listOpinionForAddress">'+(a(e)||"Отзывов пока нет")+"</div>",t+="<form>",t+='<h4 style="color: #f6856e;"> ВАШ ОТЗЫВ</h4>',t+='<input type="text" class="input" id="inputName" placeholder="Имя"><br>',t+='<input type="text" class="input" id="inputPlace" placeholder="Компания"><br>',t+='<textarea class="input" placeholder="Ваши впечатления" id="inputOpinion" rows="6"></textarea><br>',t+="<button id='addbutton' type='button'>Добавить</button>",t+="</form>"}function a(e){var t="";return l.filter(function(t){return t.address==e}).forEach(function(e){t+="<b>"+e.name+"</b> ",t+=e.place+" ",t+=e.date+"<br>",t+=e.opinion+"<br>"}),t}function d(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1;o<10&&(o="0"+o);var n=e.getDate();n<10&&(n="0"+n);var a=e.getHours();a<10&&(a="0"+a);var r=e.getMinutes();r<10&&(r="0"+r);var l=e.getSeconds();return l<10&&(l="0"+l),t+"."+o+"."+n+" "+a+":"+r+":"+l}var u=new ymaps.Map("map",{center:[55.753994,37.622093],zoom:16,controls:[]},{searchControlProvider:"yandex#search"}),p=ymaps.templateLayoutFactory.createClass('<div class="templateBalloon"><a class="close" id="close" href="#">&times;</a>$[[options.contentLayout observeSize maxWidth=310  maxHeight=500]]</div>'),b=ymaps.templateLayoutFactory.createClass('<div class="templateBalloonHeader"><b>{{properties.balloonContentHeader}}</b><br /></div><div class="templateBalloonBody">$[properties.balloonContentBody]</div>'),f=ymaps.templateLayoutFactory.createClass('<div class="templateBalloonHeader"><b>{{contentHeader}}</b><br /></div><div class="templateBalloonBody">$[contentBody]</div>'),y=ymaps.templateLayoutFactory.createClass('<h2 class=ballon_place>{{ properties.balloonPlace|raw }}</h2><div class=ballon_address ><a href="#" id="linkPlacemark">{{properties.balloonContentHeader|raw }}</a></div><div class=ballon_opinion>{{ properties.balloonOpinion|raw }}</div><div class=ballon_date>{{ properties.balloonDate|raw }}</div>'),v=new ymaps.Clusterer({clusterDisableClickZoom:!0,clusterOpenBalloonOnClick:!0,clusterBalloonContentLayout:"cluster#balloonCarousel",clusterBalloonItemContentLayout:y,clusterBalloonPanelMaxMapArea:0,clusterBalloonContentLayoutWidth:200,clusterBalloonContentLayoutHeight:130,clusterBalloonPagerSize:5});!function(){for(var e=[],o=0;o<l.length;o++)if(-1==e.indexOf(l[o].address)){var n=t(l[o]);u.geoObjects.add(n),e.push(l[o].address),c.push(n)}v.add(c),u.geoObjects.add(v)}(),u.events.add("click",function(e){if(u.balloon.isOpen())u.balloon.close();else{var t=e.get("coords");o(t).then(function(e){i=e,s=t,u.balloon.open(t,{contentHeader:e,contentBody:n(i)},{layout:p,contentLayout:f})})}}),map.addEventListener("click",function(t){if("addbutton"==t.target.id&&e(),"close"==t.target.id&&u.balloon.close(),"linkPlacemark"==t.target.id)for(var o=0;o<c.length;o++)c[o].properties.get("balloonContentHeader")==t.target.innerText&&u.balloon.open(c[o].properties.get("balloonCoords"),{contentHeader:c[o].properties.get("balloonContentHeader"),contentBody:n(t.target.innerText)},{layout:p,contentLayout:f})})}var a=o(0),r=function(e){return e&&e.__esModule?e:{default:e}}(a),l=[];localStorage.getItem("myPlacemarkList")&&(l=JSON.parse(localStorage.getItem("myPlacemarkList")));var s,i="",c=[];ymaps.ready(n)},function(e,t,o){var n=o(3),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t){var o=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=o)}]);
//# sourceMappingURL=748ed7aac665d7985f9e.js.map